// ==UserScript==
// @name         Clyde STN
// @namespace    http://stnpdapp.rail.nsw.gov.au:5555/stn
// @version      0.1
// @description  Load Clyde NWB Maintenance Windows on STN Online
// @author       Jonathan Lam
// @match        http://stnpdapp.rail.nsw.gov.au:5555/*
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @grant        GM_addStyle
// ==/UserScript==

GM_addStyle ( `
.btn-clyde {
  color: #fff;
  background-color: #d63384;
  border-color: #d63384;
}

.btn-clyde:hover {
  color: white !important;
  background-color: #ab296a;
  border-color: #ab296a;
}
` );

window.addEventListener('load', function() {
    //run();
}, false);

window.setTimeout(loopfunc, 1000);

function loopfunc() {
if ( $( "#searchControllerDiv" ).length ) {
  run();
}
}

function run() {
    'use strict';
    $("#searchControllerDiv").before("<button class='btn btn-clyde' id='mwsearchbtn'>Search Clyde MW</button>");

$("#mwsearchbtn").click(function(e) {
    e.preventDefault();
    mwsearch();
});

function filter_response(res) {
	var data = [];
	res.forEach(function(stn) {
		if (stn.title.includes('MW')
		    && (
			//	stn.title.includes('06')
		    //||  stn.title.includes('07')
		      stn.title.includes('08')
		    || 	stn.title.includes('09')
		    || 	stn.title.includes('12')
		    || 	stn.title.includes('16')
		    || 	stn.title.includes('17')
		    || 	stn.title.includes('21')
		    || 	stn.title.includes('22')
		    || 	stn.title.includes('23')
		    || 	stn.title.includes('24')
		    || 	stn.title.includes('25')
		    || 	stn.title.includes('26')
			)
		) data.push(stn);
	})
	return data;
}


function mwsearch() {
	var url1 = 'SearchSTNController?action=findByLocation&action1=findByCustomer&locationList=&customerList=&startDate=28-03-2022&endDate=03-04-2022&selecteditems=Proforma&searchBoxText=';

	$.ajax({
		type : 'post',
		url : url1,
		dataType : "json",
		success : function(response) {
			document.getElementById("filter").style.display = "none";
			document.getElementById("validStart").style.display = "none";
			document.getElementById("NoRecordSTNDiv").style.display = "none";
			document.getElementById("searchControllerDiv").style.display = "block";
			$("#grid1").jqGrid("GridUnload");
			$("#grid1").jqGrid(
							{
								colModel : [
										{
											name : "name",
											label : "STN",
											width : 80,
											formatter : formateLink
										},
										{
											name : "title",
											label : "Title",
											width : 760,
											formatter : formatetitleLink
										},
										{
											name : "contents",
											label : "Contents",
											width : 185
										},
										{
											name : "startDate",
											label : "Start Date",
											width : 80,
											align: "right"
										},
										{
											name : "endDate",
											label : "End Date",
											width : 80,
											align: "right"
										},
										{
											name : "vide",
											label : "Vide",
											width : 80,
											formatter : formateLink1,
											align: "right"
										},

								],
								data : filter_response(response),
								iconSet : "fontAwesome",
								idPrefix : "g1_",
								rownumbers : true,
								sortname : "invdate",
								sortorder : "desc",
								caption : "Recently Published Daily STN",
								threeStateSort : true,
								sortIconsBeforeText : true,
								headertitles : true,
								toppager : true,
								pager : true,
								width : 1300,
								height : 450,
								shrinkToFit : false,
								rowNum : 20,
							});

		},
		error : function() {
			document.getElementById("searchControllerDiv").style.display = "none";
			document.getElementById("NoRecordSTNDiv").style.display = "block";

		}
	});
}


};